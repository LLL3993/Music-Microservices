# 前端界面优化日志（music-web）

日期：2025-12-28

## 1）发现音乐页：图片展示框高度调整

### 优化目标
- 顶部图片展示框（轮播）竖直高度略微变小，视觉更紧凑。

### 实现思路
- 直接调整 `Discover.vue` 中轮播容器 `.banner-stage` 的 `height`。

### 具体实现
- 文件：[Discover.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Discover.vue)
  - `.banner-stage height: 320px -> 260px`

## 2）发现音乐页：推荐歌单区域上移 + 卡片变高 + 保持与播放面板间距

### 优化目标
- 推荐歌单标题与列表整体向上提一点。
- 推荐歌单卡片竖直高度增大（更“像歌单封面”）。
- 页面底部留出一定空间，避免贴近播放面板的视觉压迫感。

### 实现思路
- 调整页面级 gap、标题 margin、列表 padding。
- 增大歌单封面图高度 `.item-img height`。

### 具体实现
- 文件：[Discover.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Discover.vue)
  - `.page gap: 24px -> 18px`，并将 `padding-bottom` 调整为 `16px`（缩小与底部播放面板距离）
  - `.section-title margin-top/margin-bottom` 下调，减小标题上下空隙
  - `.row padding` 调整，减少顶部留白、底部留一定距离
  - `.item-img height: 150px -> 270px`

## 3）公开歌单可见性：推荐歌单对所有人可见（不区分用户）

### 问题现象
- “发现音乐”页面推荐歌单属于公开歌单，但在未登录/或非创建者情况下无法正常展示（尤其封面依赖歌单详情时）。
- “歌单”页面只展示当前用户歌单，无法浏览全站公开歌单。

### 目标
- 公开歌单：所有人都能看见并能打开详情（只读）。
- 私密歌单：仍然只允许创建者登录后查看与管理（增删歌单/增删歌曲/切换公开状态）。
- 尽量复用现有后端接口；若现有接口不满足，再做最小增量。

### 实现思路
1. 发现页推荐歌单：
   - 歌单列表来源固定使用 `GET /api/playlists/public`（无需登录）。
   - 封面推断依赖歌单第一首歌：需要获取歌单详情列表。
   - 原有 `GET /api/playlist-details` 需要 `X-Username`（网关注入），未登录无法获取，因此对“公开歌单详情”补齐“匿名只读”能力。
2. 歌单页：
   - 未登录时改为展示全站公开歌单列表（只读）。
   - 登录后仍展示我的歌单，并且仅对“我创建的歌单”显示删除/修改公开状态/移除歌曲等操作按钮。

### 后端改动（最小增量，不新增冗余接口）
- 文件：[JwtAuthGlobalFilter.java](file:///c:/Users/LLL/Desktop/Music-Microservices/gateway-service/src/main/java/com/zjsu/lyy/gateway_service/security/JwtAuthGlobalFilter.java)
  - 允许 `GET /api/playlist-details` 匿名访问（与 `GET /api/playlists/public` 一样），同时保留“带 token 时继续解析并注入 X-Username”的能力。
- 文件：[PlaylistDetailController.java](file:///c:/Users/LLL/Desktop/Music-Microservices/list-service/src/main/java/com/zjsu/lyy/list_service/controller/PlaylistDetailController.java)
  - `X-Username` 变为可选：缺失则走“公开歌单只读查询”，存在则走原逻辑（用户自己的歌单查询）。
- 文件：[PlaylistDetailService.java](file:///c:/Users/LLL/Desktop/Music-Microservices/list-service/src/main/java/com/zjsu/lyy/list_service/service/PlaylistDetailService.java)
  - 新增 `listPublicDetails(playlistName)`：通过“公开歌单实体”定位创建者，再按创建者+歌单名读取详情。
- 文件：[PlaylistService.java](file:///c:/Users/LLL/Desktop/Music-Microservices/list-service/src/main/java/com/zjsu/lyy/list_service/service/PlaylistService.java)
  - 新增 `getPublicPlaylistEntityByName(playlistName)`：按公开条件定位歌单。
- 文件：[PlaylistRepository.java](file:///c:/Users/LLL/Desktop/Music-Microservices/list-service/src/main/java/com/zjsu/lyy/list_service/repository/PlaylistRepository.java)
  - 新增 `findFirstByPlaylistNameAndIsPublicTrueOrderByIdDesc(...)`：用于按名称定位公开歌单（同名时取最新一条）。

### 前端改动
- 文件：[Discover.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Discover.vue)
  - 推荐歌单列表固定请求 `/api/playlists/public`
  - 封面推断固定请求 `/api/playlist-details?playlistName=...`（匿名可用）
- 文件：[Playlists.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Playlists.vue)
  - 未登录：请求 `/api/playlists/public?limit=50` 展示公开歌单
  - 路由携带 `playlistName` 时：优先本地列表匹配，匹配不到则回退请求 `/api/playlists/playlist-name`
  - 详情加载：优先匿名请求 `/api/playlist-details`；失败且已登录时再携带 `Authorization` 重试
  - 操作权限：仅当 `auth_user.username === selectedPlaylist.username` 时显示删除/公开开关/移除歌曲按钮

## 4）发现音乐页：推荐歌单封面修复为“歌单第一首歌封面”

### 问题现象
- 公开歌单在“发现音乐”推荐区域的封面无法正确展示（只拿到歌单名/创建者信息，不包含封面字段）。

### 目标
- 推荐歌单封面展示为“歌单中第一首歌”的封面（与歌单详情页展示的歌曲顺序一致）。

### 实现思路
- 推荐歌单列表仍使用 `GET /api/playlists/public` 获取歌单元信息。
- 通过 `GET /api/playlist-details` 获取歌单详情（歌曲列表），按 `id` 由小到大排序后取第一首歌 `songName`。
- 封面图片路径按静态资源约定拼接：`/data/cover/<songName>.jpg`。

### 具体实现
- 文件：[Discover.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Discover.vue)
  - 新增 `resolveCoverUrl(playlistName, username)`：拉取详情并推断第一首歌封面
  - `loadRecommendedPlaylists()` 与 `openAll()` 中统一调用 `resolveCoverUrl`

## 5）发现音乐页：新增“为你推荐”入口并弹窗展示全部公开歌单

### 优化目标
- 在“推荐歌单”标题最右侧增加可点击文字“为你推荐”。
- 点击后弹出新界面，展示全部公开歌单（可直接点击跳转到歌单详情）。

### 实现思路
- 复用现有接口 `GET /api/playlists/public?limit=...`，弹窗打开时拉取公开歌单列表。
- 为避免一次性串行拉取封面造成等待过久，使用并发映射方式批量推断封面。
- 弹窗容器复用通用遮罩组件 `OverlayMask`，保持交互一致。

### 具体实现
- 文件：[Discover.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Discover.vue)
  - 标题区新增按钮：`<button class="section-action" ...>为你推荐</button>`
  - “为你推荐”从弹窗改为路由页面跳转：点击后进入 `Recommended` 页面
- 文件：[Recommended.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Recommended.vue)
  - 页面展示全部公开歌单列表（请求 `/api/playlists/public?limit=200`）
- 文件：[router/index.js](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/router/index.js)
  - 新增路由：`/recommended`（name: `Recommended`）

## 6）公开歌单详情：独立页面展示并复用“歌单详情”样式

### 优化目标
- 在“为你推荐”页点击歌单后，进入一个新的详情页面（非弹窗）。
- 详情样式参考“歌单”页的“歌单详情”，但只读展示。
- “发现音乐”页的推荐歌单点击后也进入同一详情页面（不进入 `Playlists`）。

### 实现思路
- 新增一个公开歌单详情页 `PublicPlaylist.vue`，直接复用 `Playlists.vue` 的详情布局与样式类（`.detail-head/.detail-layout/.detail-songs`）。
- 页面通过 query 参数接收 `playlistName` 与可选 `username`，复用现有接口：
  - `GET /api/playlists/playlist-name?playlistName=...`（用于补齐歌单描述等元信息，必要时回退）
  - `GET /api/playlist-details?playlistName=...&username=...`（用于拉取歌曲列表，封面取第一首歌）

### 具体实现
- 文件：[PublicPlaylist.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/PublicPlaylist.vue)
  - 使用详情列表第一首歌封面作为歌单封面
  - 列表点击播放按钮复用现有 `player:set` 事件与 `/player` 跳转
- 文件：[router/index.js](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/router/index.js)
  - 新增路由：`/public-playlist`（name: `PublicPlaylist`）
- 文件：[Discover.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Discover.vue)
  - 推荐歌单卡片点击跳转到 `PublicPlaylist`
- 文件：[Recommended.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Recommended.vue)
  - 列表点击跳转到 `PublicPlaylist`（移除详情弹窗逻辑）

## 7）搜索页：搜索结果封面改为真实封面

### 问题现象
- 搜索结果列表中歌曲封面一直是占位图，无法体现歌曲封面资源。

### 实现思路
- 按静态资源约定拼接封面路径：`/data/cover/<songName>.jpg`，并保留占位图兜底。

### 具体实现
- 文件：[Search.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Search.vue)
  - 增加 `coverUrlBySong(songName)` 并替换列表封面 `:src` 绑定

## 8）公开歌单封面/详情 401（Unauthorized）修复

### 问题现象
- 已登录用户在拉取公开资源（公开歌单详情、用于推断封面）时，浏览器报错 `401 (Unauthorized)`，导致推荐歌单/公开歌单封面与详情无法加载。

### 根因
- 网关对“公开接口”在请求携带 `Authorization: Bearer ...` 且 token 失效/解析失败时，会直接返回 401，导致本应公开可读的资源也被拦截。
- 同时，当用户已登录且请求携带 `X-Username` 时，`/api/playlist-details` 默认按“我的歌单”逻辑查询，导致查询其他用户公开歌单时失败。

### 修复策略（不新增接口）
- 网关：对公开可读接口实行“可选鉴权”，token 可用则注入用户信息，不可用则降级为匿名继续放行。
- 列表服务：当请求带 `username` 参数且与 `X-Username` 不一致时，按“公开歌单只读查询”处理。

### 具体实现
- 文件：[JwtAuthGlobalFilter.java](file:///c:/Users/LLL/Desktop/Music-Microservices/gateway-service/src/main/java/com/zjsu/lyy/gateway_service/security/JwtAuthGlobalFilter.java)
  - 放开 `GET /api/playlist-details**`、`GET /api/playlists/public**`（支持子路径/尾斜杠）
  - 对公开接口：token 为空或解析失败时不返回 401，直接匿名放行
- 文件：[PlaylistDetailController.java](file:///c:/Users/LLL/Desktop/Music-Microservices/list-service/src/main/java/com/zjsu/lyy/list_service/controller/PlaylistDetailController.java)
  - 已登录但查询他人公开歌单（username 参数 != X-Username）时，走 `listPublicDetails(username, playlistName)`

## 9）登录/注册：支持回车提交

### 优化目标
- 登录、注册表单在输入框按回车即可提交，不需要必须点击按钮。

### 具体实现
- 文件：[Layout.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Layout.vue)
  - 登录表单容器增加 `@keydown.enter.prevent="submitLogin"`
  - 注册表单容器增加 `@keydown.enter.prevent="submitRegister"`

## 10）歌单详情框：增高 + 左侧信息区重排与放大

### 优化目标
- 歌单详情整体竖直方向更“展开”，并与下方播放面板保持一定距离。
- 左侧歌单信息区布局匹配增高后的空间：图片更大、标题更大、信息更清晰。

### 实现思路
- 将左侧信息区从“上下排列”调整为“封面在左、信息在右”（桌面端）。
- 提升封面尺寸、标题字号、描述字号。
- 右侧歌曲列表区域增加 `min-height` 与 `max-height`，超出时滚动，避免页面过长与贴近底部播放面板。

### 具体实现
- 文件：[Playlists.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Playlists.vue)
  - `.detail-layout` 增大 `gap`，增加 `min-height`
  - `.detail-head` 改为 `flex-direction: row`，封面与信息左右布局（移动端保持列布局）
  - `.cover` 180x180 -> 220x220（移动端仍为 120x120）
  - `.info .name` 字号提升到 26px
  - `.detail-songs` 增加 `min-height`，并设置 `max-height + overflow: auto`
  - `.page` 增加 `padding-bottom: 16px`

## 11）为你推荐页：列表滚动 + 底部播放面板始终可见

### 问题现象
- “为你推荐”歌单数量很多时，页面高度被列表撑大，导致底部播放面板被挤到页面下方，需要滚动才能看到完整播放面板。

### 优化目标
- 无论列表多少，底部播放面板始终在视口内可见（不需要滚动才能看到播放面板）。
- 列表超出时在内容区内部滚动。

### 实现思路
- 将整体布局从 `min-height: 100vh` 调整为固定视口高度 `height: 100vh`，让中间内容区通过 `overflow: auto` 自己滚动。
- 在“为你推荐”页将列表区域设为可滚动容器，避免撑高页面。

### 具体实现
- 文件：[Layout.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Layout.vue)
  - `.layout` 使用 `height: 100vh` + `overflow: hidden`，保证底部播放面板不会被页面高度撑下去
- 文件：[Recommended.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Recommended.vue)
  - `.row` 增加 `flex: 1; overflow: auto; min-height: 0`，列表过多时在页面内容区滚动

## 12）公开歌单详情：歌单简介不显示修复

### 问题现象
- 公开歌单详情页可以显示歌曲列表，但歌单简介始终显示“无描述”。

### 根因
- 详情页为了拿到 `description` 会调用 `GET /api/playlists/playlist-name`，该接口在网关侧默认需要携带 `Authorization`，未登录时会 401，导致只能使用空描述兜底。

### 修复策略（不新增接口）
- 已登录：`/api/playlists/playlist-name` 请求携带 `Authorization`，正常拿到 description。
- 未登录：改为从 `GET /api/playlists/public?limit=200` 的公开列表中匹配到目标歌单，从而拿到 description。

### 具体实现
- 文件：[PublicPlaylist.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/PublicPlaylist.vue)
  - 拉取歌单元信息时优先使用带 `Authorization` 的 `/api/playlists/playlist-name`
  - 无 token 时回退到 `/api/playlists/public` 匹配 `playlistName/username` 获取 description

## 13）进度条外侧高亮：仅拖动时显示

### 优化目标
- 进度条“外侧一圈”的高亮效果只在拖动进度条时出现，松开后消失（不影响进度条本身的颜色）。

### 实现思路
- 显式移除 range 输入的浏览器默认 focus/active 外圈效果。
- 利用现有 `isSeeking` 状态，在拖动期间给 range 增加 `.seeking` 类，并仅在该类下添加外圈 `box-shadow`。

### 具体实现
- 文件：[Layout.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Layout.vue)
  - `.playerbar-range:focus/:focus-visible` 去掉 `box-shadow`
  - `.playerbar-range.seeking` 增加外圈 `box-shadow`
- 文件：[Player.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Player.vue)
  - `.range:focus/:focus-visible` 去掉 `box-shadow`
  - `.range.seeking` 增加外圈 `box-shadow`

## 14）个人中心：头像悬浮菜单入口 + 用户信息页

### 优化目标
- 用户 hover 头像后，在“退出登录”上方新增“个人中心”按钮。
- 点击后进入一个与发现音乐/搜索一致的页面容器，展示用户个人信息。

### 实现思路
- 前端直接复用现有用户查询接口 `GET /api/users/username?username=...` 拉取用户信息。
- 入口放在顶栏用户菜单中，通过路由跳转到新页面展示。

### 具体实现
- 文件：[Layout.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Layout.vue)
  - 用户菜单新增按钮：`个人中心`，点击路由跳转到 `Profile`
- 文件：[Profile.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Profile.vue)
  - 新增个人中心页面：使用 `Authorization` 调用 `/api/users/username` 拉取并展示 `username/email`
- 文件：[router/index.js](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/router/index.js)
  - 新增路由：`/profile`（name: `Profile`）

## 15）发现音乐页：推荐歌单标题优化（居中、加大字号与字间距、列表下移）

### 优化目标
- “推荐歌单”标题居中显示，字体更醒目。
- 字体之间间隙增大，并让下方歌单列表稍微下移，避免标题显得拥挤。

### 具体实现
- 文件：[Discover.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Discover.vue)
  - 标题区使用三列 grid：左侧占位、标题居中、右侧放“为你推荐”
  - `.section-title` 字号提升到 `28px`，并设置 `letter-spacing: 6px`
  - `.row` 顶部 padding 增加到 `10px`，让列表整体更靠下

## 16）为你推荐页：列表上下边界对齐播放面板并提升上边界

### 优化目标
- 歌单展示区域下边界与底部播放面板上边界贴合对齐。
- 上边界适当上移，整体视觉更饱满，同时保持播放面板始终可见。

### 具体实现
- 文件：[Recommended.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Recommended.vue)
  - `.page padding-bottom` 调整为 `0`，避免列表与播放面板之间多余留白
  - `.row padding-bottom` 调整为 `0`，列表滚动区域与内容区底部对齐

## 17）个人中心：隐藏用户ID/管理员 + 支持修改用户名/邮箱/密码

### 优化目标
- 个人中心不显示用户ID与管理员字段，界面更简洁。
- 为用户名、邮箱、密码提供“修改”按钮，让用户自行更新信息。

### 实现思路
- 复用现有后端接口 `PUT /api/users/{id}`，不新增接口。
- 由于后端 `UpdateUserRequest` 需要 `username/email/password/isAdmin` 全量字段：
  - 修改用户名/邮箱时要求输入密码作为确认。
  - 修改密码时要求输入新密码与确认密码。

### 具体实现
- 文件：[Profile.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Profile.vue)
  - 移除用户ID与管理员信息展示，仅保留用户名/邮箱/密码（掩码）
  - 新增编辑弹窗（username/email/password 三种模式），提交时调用 `PUT /api/users/{id}`
  - 成功后刷新本地 `auth_user`

## 19）个人中心：修改用户名后自动刷新登录态（无需重新登录）

### 问题现象
- 修改用户名后，如果仍沿用旧 token，会出现“界面显示已改名，但后端仍按旧用户名注入/校验”的不一致问题。

### 实现思路
- 修改用户名时，表单本身已经要求输入密码作为确认，因此可以在更新成功后，直接调用一次登录接口获取新 token（subject 为新用户名）。
- 全程在前端自动完成，不需要用户手动退出/重新登录。

### 具体实现
- 文件：[Profile.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Profile.vue)
  - `PUT /api/users/{id}` 成功后，若用户名发生变化：再请求 `POST /api/auth/login`（username=新用户名，password=确认密码）
  - 使用返回的 `token/user` 覆盖本地 `auth_token/auth_user`，并触发 `auth:changed`，最后重新拉取用户信息刷新页面

## 20）为你推荐页：卡片 hover 不再被顶部遮挡

### 问题现象
- 列表最上方一排卡片在 hover 时会上移/变大，因列表容器滚动裁切导致顶部被遮住一部分。

### 实现思路
- 保留 hover 的视觉反馈（阴影/边框），移除 hover 位移与图片缩放，避免触发“越界裁切”。
- 同时给列表容器顶部补一点 padding，让首行卡片离上边界更安全。

### 具体实现
- 文件：[Recommended.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Recommended.vue)
  - `.hover-lift:hover` 在该页面覆盖为 `transform: none`
  - `.item:hover` 移除位移，`.item:hover .item-img` 移除缩放
  - `.row padding-top` 增加，确保首行 hover 阴影也不会贴边

## 21）收藏图标：替换爱心为星标

### 优化目标
- 修复爱心图标显示不稳定/观感不佳的问题，统一替换为星标（选中：实心；未选中：描边）。

### 具体实现
- 文件：[Layout.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Layout.vue)
  - 播放面板收藏按钮 SVG 替换为星标
- 文件：[Search.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Search.vue)
  - 搜索结果收藏按钮 SVG 替换为星标

## 22）验证

- 前端：在 `music-web/` 下执行 `npm run build`
- 后端：在 `gateway-service/`、`list-service/` 下执行 `mvn test`

## 23）顶栏：图标旁增加艺术字站点名称“LYY-Music”

### 优化目标
- 在网页图标旁增加站点名称，并使用艺术字效果增强品牌识别。

### 实现思路
- 直接在 `Layout.vue` 顶栏品牌区增加文本节点。
- 使用渐变文字 + 动态流光动画实现“艺术字”效果；小屏下隐藏文本，避免顶栏拥挤。

### 具体实现
- 文件：[Layout.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Layout.vue)
  - 顶栏 `.brand` 内新增 `<span class="brand-name">LYY-Music</span>`
  - 新增样式 `.brand-name`：渐变裁剪到文字、`@keyframes` 背景位移动画
  - `@media (max-width: 980px)` 下隐藏 `.brand-name`

## 24）播放面板：歌词加载失败固定提示“该歌曲暂无歌词”

### 优化目标
- 歌词文件不存在或加载失败时，播放面板统一显示“该歌曲暂无歌词”，避免出现不一致或空白提示。

### 实现思路
- 在歌词加载函数中对 fetch 失败和解析为空两种情况统一设置兜底文案。

### 具体实现
- 文件：[Layout.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Layout.vue)
  - `loadLyrics(song)` 中：
    - 解析结果为空：将 `lyricItems` 兜底为 `[{ time: 0, text: '该歌曲暂无歌词' }]`
    - 请求异常：同时设置 `lyricError = '该歌曲暂无歌词'` 并兜底 `lyricItems`

## 25）个人中心：修改密码需先校验原密码

### 优化目标
- 用户修改密码前必须先输入原密码，提升安全性，避免“拿到登录态即可无感改密”的风险。

### 实现思路
- 不新增后端接口，复用现有登录接口进行原密码校验：
  - 提交修改密码前先调用 `POST /api/auth/login`（username=当前用户名，password=原密码）
  - 校验通过后再调用 `PUT /api/users/{id}` 更新密码
- 更新密码成功后，再用新密码登录一次刷新 token，保证后续请求不受旧 token 影响。

### 具体实现
- 文件：[Profile.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Profile.vue)
  - 修改密码弹窗新增“原密码”输入框 `editForm.originalPassword`
  - `submitEdit()` 在 `editMode === 'password'` 时：
    - 先执行原密码校验（失败提示“原密码错误”）
    - 更新成功后使用新密码重新登录刷新 `auth_token/auth_user` 并触发 `auth:changed`

## 26）播放面板：新增歌单来源选择按钮，驱动上一首/下一首

### 优化目标
- 在播放面板收藏按钮右侧新增一个图案按钮。
- 点击后可选择“我的歌单 / 公开歌单”，并选择具体歌单，作为下一首/上一首的播放队列来源。

### 实现思路
- 不新增接口，复用现有歌单接口：
  - 我的歌单：`GET /api/playlists/username`（需要 Authorization）
  - 公开歌单：`GET /api/playlists/public?limit=...`（匿名可用）
  - 歌单歌曲列表：`GET /api/playlist-details?playlistName=...&username=...`（失败且已登录时带 Authorization 重试）
- 选择歌单后，将该歌单歌曲 `songName` 列表写入 `playerState.queue`，后续上一首/下一首均基于该队列切歌。
- 当当前歌曲不在队列中：
  - 点击“下一首”从队列第一首开始
  - 点击“上一首”从队列最后一首开始

### 具体实现
- 文件：[Layout.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Layout.vue)
  - 播放面板按钮区新增“歌单来源”按钮，打开选择弹窗
  - 弹窗支持切换“我的歌单/公开歌单”，并展示列表选择
  - 选择歌单后请求详情并更新 `playerState.queue/index`
  - 调整 `playNext()/playPrev()`：基于当前歌曲在队列中的位置计算切歌索引，兼容“当前歌曲不在队列”的情况

## 27）播放面板：切歌遮罩不叠加 + 来源切换更丝滑 + 无队列重播 + 新增“我的收藏”来源

### 优化目标
- 不断点击“上一首/下一首”时，不出现多个播放页遮罩叠加。
- 在“我的歌单/公开歌单”之间切换时不闪屏，体验更丝滑。
- 未选择任何来源队列时，点击上一首/下一首直接重播当前歌曲。
- 歌单来源选择中增加“我的收藏”，让上一首/下一首可基于收藏夹切歌。

### 实现思路
1. 防止遮罩叠加：
   - 对 `playPrev()/playNext()` 增加“并发锁”，在一次切歌链路未结束前忽略后续点击，避免路由/播放器状态连续触发造成遮罩重复出现。
2. 切换不闪屏：
   - 维护“目标 Tab”与“展示 Tab”两套状态：点击 Tab 时先切换按钮高亮并开始加载，但列表仍保持上一次内容直到新数据加载完成再替换，避免空白闪一下。
   - 对 loading 提示做延迟触发（短时间内数据返回则不展示 loading），进一步减少闪烁感。
3. 无队列时重播：
   - 当 `playerState.queue` 为空时，`playPrev()/playNext()` 直接调用 `replayCurrent()`：将 `currentTime` 归零并重新 `play()`。
4. 新增“我的收藏”来源（不新增接口）：
   - 复用现有接口 `GET /api/favorites/username` 拉取收藏列表，并将收藏的 `songName` 去重排序后写入 `playerState.queue`，用于上一首/下一首。

### 具体实现
- 文件：[Layout.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Layout.vue)
  - 切歌并发锁：新增 `isNavigating`，包裹 `playPrev()/playNext()` 的异步流程，避免连续触发叠加
  - 无队列重播：新增 `replayCurrent()` 并在 `queue` 为空时调用
  - 收藏来源：歌单来源弹窗支持收藏夹作为来源，并实现 `applyQueueFromFavorites()` 写入队列
  - 丝滑切换：新增 `queueSourceDisplayTab`，并在加载完成后再更新展示内容；loading 增加 150ms 延迟触发

## 28）播放面板：切歌歌手信息同步 + 收藏夹入口并入“我的收藏/歌单” + 歌词框向左加宽

### 优化目标
- 点击上一首/下一首时，歌手信息随歌曲同步更新（播放面板与播放页遮罩一致）。
- “切换下一首/上一首歌单来源”里移除“我的收藏”Tab，将收藏夹入口并入“我的歌单”顶部，并将该 Tab 更名为“我的收藏/歌单”。
- 播放面板歌词展示框向左稍微加宽，其他控件位置不变。

### 实现思路
1. 歌手信息不更新：
   - 上一首/下一首切歌时只更新了 `songName`，未重置/刷新 `artist`，导致 UI 继续展示旧值。
   - 处理方式：切歌时将 `artist` 置空，并复用现有的 `resolveArtistIfMissing(songName)` 重新拉取歌手信息（不新增接口）。
2. 收藏夹入口并入“我的收藏/歌单”：
   - 保留 `GET /api/favorites/username` 的加载与 `applyQueueFromFavorites()` 的写队列逻辑。
   - UI 上不再单独提供 Tab，而是在“我的收藏/歌单”列表最上方固定放一个“收藏夹”按钮作为来源入口。
3. 歌词框向左加宽且不影响其他布局：
   - 通过“增加宽度 + 等量负的左外边距”实现视觉向左变宽，同时保持占用的布局宽度不变，避免挤压右侧按钮。

### 具体实现
- 文件：[Layout.vue](file:///c:/Users/LLL/Desktop/Music-Microservices/music-web/src/views/Layout.vue)
  - 切歌同步歌手：`playPrev()/playNext()` 内将 `artist` 置空并触发 `resolveArtistIfMissing()`
  - 弹窗结构调整：Tab “我的歌单”改为“我的收藏/歌单”，移除“我的收藏”Tab，并在列表顶部加入“收藏夹”入口，点击后使用收藏夹作为队列
  - 歌词框加宽：`.playerbar-current-lyric` 增加 `width` 并配合 `margin-left` 让其向左拉长但不改变其他控件位置
