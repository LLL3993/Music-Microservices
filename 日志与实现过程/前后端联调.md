# connect.md（联调与开发日志）

## 1) 前端登录 / 注册（走网关）

### 实现内容

- 顶部栏「登录 / 注册」按钮弹出弹窗表单
- 注册表单：用户名 / 邮箱 / 密码 / 确认密码（均必填）
- 登录表单：用户名 / 密码（均必填）
- 登录弹窗内提供「去注册」，注册弹窗内提供「去登录」用于切换
- 登录/注册成功后保存 `token` 与用户信息到 `localStorage`，并在顶部展示当前用户名
- 提供「退出登录」清理 `localStorage`

### 关键实现点

- 统一通过 `gateway-service`（默认 `http://localhost:8090`）调用：
  - `POST /api/auth/login`
  - `POST /api/auth/register`
- 登录/注册成功后响应体中读取：
  - `token`
  - `user`

对应前端实现文件：

- `music-web/src/views/Layout.vue`

## 2) meta-service：新增按歌手名查询接口 + 模糊查询支持

### 实现内容

- 新增「按歌曲名模糊查询」接口：`GET /api/meta/song-name-like?songName=...`
- 新增「按歌手名模糊查询」接口：`GET /api/meta/artist-name?artistName=...`
- 两个接口返回 `MetaResponse` 列表（可能为空数组）

对应后端实现文件：

- `meta-service/src/main/java/com/zjsu/lyy/meta_service/controller/MetaController.java`
- `meta-service/src/main/java/com/zjsu/lyy/meta_service/service/MetaService.java`
- `meta-service/src/main/java/com/zjsu/lyy/meta_service/repository/MetaRepository.java`

## 3) 搜索页：联合模糊查询并合并展示

### 实现内容

- 搜索页根据关键词同时请求：
  - `GET /api/meta/song-name-like?songName=关键词`
  - `GET /api/meta/artist-name?artistName=关键词`
- 将两组结果按 `id`（或 `songName+artist`）去重合并后展示
- 当未登录（缺少 `auth_token`）时提示「请先登录后再搜索」

对应前端实现文件：

- `music-web/src/views/Search.vue`

## 4) 联调方式（本地）

### 需要启动的服务

- `user-service`：`8081`
- `meta-service`：`8082`
- `list-service`：`8083`
- `gateway-service`：`8090`
- `music-web`：Vite dev server（默认 `5173`）

### 后端构建与测试

在各自微服务目录下执行：

- `mvn clean test`

### 前端运行

在 `music-web/` 下执行：

- `npm run dev`

### 访问与验证

- 打开前端页面后点击「注册」完成注册（会拿到 `token`）
- 登录后在搜索页输入关键词，查看「歌曲名包含关键词」或「歌手名包含关键词」的记录是否合并展示

## 5) 前端交互修复（登录注册弹窗 / 用户菜单）

### 实现内容

- 用户头像悬浮菜单与头像之间的距离调整更近
- 登录/注册弹窗点击遮罩区域不再自动关闭（仅通过右上角关闭按钮关闭）
- 登录/注册弹窗移除密码旁「显示/隐藏」按钮

对应前端实现文件：

- `music-web/src/views/Layout.vue`

## 6) 我的收藏页面（接入 list-service）

### 实现内容

- 新增「我的收藏」页面，调用 list-service 现有接口拉取收藏记录并展示
- 请求通过网关携带 `Authorization: Bearer <token>`，由网关注入 `X-Username` 给 list-service

接口：

- `GET /api/favorites/username`

对应前端实现文件：

- `music-web/src/views/Favorites.vue`

## 7) 歌单页面（接入 list-service）

### 实现内容

- 新增「歌单」页面，展示当前用户歌单列表
- 点击歌单后加载该歌单下的歌曲列表并展示

接口：

- `GET /api/playlists/username`
- `GET /api/playlist-details?playlistName=...`

对应前端实现文件：

- `music-web/src/views/Playlists.vue`

## 8) 搜索结果增加收藏与加入歌单

### 实现内容

- 搜索结果列表每条歌曲增加：
  - 「收藏」：调用 list-service 收藏接口
  - 「加入」：选择歌单后调用 list-service 歌单详情新增接口

接口：

- `POST /api/favorites`
- `POST /api/playlist-details`

对应前端实现文件：

- `music-web/src/views/Search.vue`
