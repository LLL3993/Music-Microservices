12.16：整理要实现的功能与架构：

# 一、总体架构：

| 组件            | 端口 | 职责简述                            |
| --------------- | ---- | ----------------------------------- |
| gateway-service | 8090 | 统一入口、路由、鉴权                |
| user-service    | 8081 | 注册/登录/增删用户信息              |
| meta-service    | 8082 | 歌曲增删查、歌曲信息                |
| list-service    | 8083 | 收藏歌曲、歌单增删、修改歌单详情    |
| play-service    | 8084 | 播放记录、歌词聚合                  |
| nacos           | 8848 | 注册中心 + 配置中心（Nacos-Config） |



# 二、数据库与数据表：

| 数据库       | 表名       | 主要字段（简化）                          | 归属服务     |
| ------------ | ---------- | ----------------------------------------- | ------------ |
| **user\_db** | 用户表     | 用户名、邮箱、密码、是否管理员、deleted   | user-service |
| **meta\_db** | 元数据表   | 歌曲名称、歌手、deleted                   | meta-service |
| **list\_db** | 收藏表     | 用户名、歌曲名称、deleted                 | list-service |
| **list\_db** | 歌单表     | 歌单名、创建用户、简介、是否公开、deleted | list-service |
| **list\_db** | 歌单详情表 | 歌单名、歌曲名称、deleted                 | list-service |



# 三、数据一致性 & 负载均衡

| 维度         | 当前方案                  | 说明                                                    |
| ------------ | ------------------------- | ------------------------------------------------------- |
| 数据一致性   | 本地消息表                | 单实例阶段仅建表，拆库后补 `@Scheduled` + RabbitMQ 即可 |
| 服务负载均衡 | Spring Cloud LoadBalancer | 多实例已在 compose 中配置，Nacos 自动发现，无代码侵入   |



# 四、预留扩展：

| 功能     | 涉及组件             | 当前状态                  |
| -------- | -------------------- | ------------------------- |
| 消息队列 | RabbitMQ             | 仅建表，不启调度          |
| 监控     | Prometheus + Grafana | compose 里加 2 段镜像即可 |
| 链路追踪 | Sleuth + Zipkin      | 加依赖改 yml，重启生效    |



# 五、注意点：

要实现的功能根据时间可以进行取舍，优先做出一个完整的系统。